<?php

namespace PlayStation\Tests;

use PlayStation\Client;
use PlayStation\Api\MessageThread;
use PlayStation\Api\Message;

class MessagingTest extends \PHPUnit\Framework\TestCase
{
    /**
     * PlayStation Client
     *
     * @var PlayStation\Client
     */
    protected static $client;

    /**
     * The logged in user
     *
     * @var PlayStation\Api\User
     */
    protected static $loggedInUser;

    /**
     * Test User
     *
     * @var PlayStation\Api\User
     */
    protected static $testUser;

    /**
     * My PSN account
     * 
     * My account shouldn't have any privacy settings enabled which should allow all API calls to succeed.
     *
     * @var PlayStation\Api\User
     */
    protected static $tustinUser;

    public static function setUpBeforeClass()
    {
        self::$client = new Client([ 'verify' => false, 'proxy' => '127.0.0.1:8888']);

        $refreshToken = getenv('PSN_PHP_REFRESH_TOKEN');

        self::$client->login($refreshToken);

        self::$loggedInUser = self::$client->user();

        self::$testUser = self::$client->user('Test');

        self::$tustinUser = self::$client->user('tustin25');
    }

    public function testGetMessageThreadsIAmIn()
    {
        $threads = self::$loggedInUser->messageThreads();

        $this->assertInternalType('array', $threads);

        $this->assertGreaterThanOrEqual(count($threads), 1);

        $thread = $threads[0];

        $this->assertInstanceOf('\PlayStation\Api\MessageThread', $thread);
    }

    public function testTryToGetPrivateMessageThreadIAmNotIn()
    {
        $thread = self::$testUser->privateMessageThread();

        // Maybe this should throw an exception rather than null??
        $this->assertNull($thread);
    }

    public function testGetPrivateMessageThreadsWithTustin()
    {
        // This thread should exist as long as I don't accidentally leave it ;)
        $thread = self::$tustinUser->privateMessageThread();

        $this->assertInstanceOf('\PlayStation\Api\MessageThread', $thread);

        return $thread;
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testCheckPrivateMessageMemberCount(MessageThread $thread)
    {
        $this->assertEquals($thread->memberCount(), 2);
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testCheckPrivateMessageName(MessageThread $thread)
    {
        $this->assertEquals($thread->name(), 'psn-php');
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testGetAllMessagesInMessageThread(MessageThread $thread)
    {
        $messages = $thread->messages(3);

        $this->assertInternalType('array', $messages);

        $this->assertEquals(count($messages), 3);

        $message = $messages[0];

        $this->assertInstanceOf('\PlayStation\Api\Message', $message);
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testSetMessageThreadThumbnailImage(MessageThread $thread)
    {
        // Just ignore me!
        $pugImage = hex2bin("ffd8ffe000104a46494600010100000100010000ffdb0043000503040404030504040405050506070c08070707070f0b0b090c110f1212110f111113161c1713141a1511111821181a1d1d1f1f1f13172224221e241c1e1f1effdb0043010505050706070e08080e1e1411141e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1effc00011080100010003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00f7eb72db554f61564a6e43c76aa16d2313cf39ad0b73d148fad02663dfa3c4d91fa532d6e640c46ee7deb7a5b32dc8191e86aaff0065b312420e3d2810eb5b96182d5b16b71b945638b59d09564dd8e9c55b8be45e49c81401a904d9bc01ba62af4f2c517017713d47b563404e43839c77a5495da5f9dc0cfbd2633cff00e3c6b11db58c1a6da80a1cef987b76ff001af0b5bd4246233c1c1248aec3e306aad75ad5c3b9deb93b47a00700579ed9b996e3e58c051d589ae1aaeeceda4ac8b57f2cecbb092b1a72a08e7f3aa6f72eb1ef99f00738cfe95a570dba20ac7a0e33dab0f56b192e172ae42f00023a9ac2c6a889f5424bc80f0c0a819fc6a847a8309518b82e011f875a8750b3ba8c804054030b8e80d575d2ae266c82c9395c00413b88eff42282ac74f1eb9fe8c9231fbbf2e3af3e95b7a76a714f6fe63be64931bb3fc3cd71d6fa05f13b5d8a98cff0ff00171c9fcab5b4ab392d51c47990942d8f5c76a90b1d05ede2bc0ca18294383bb8e475154ae2de758d67f31153193b89e9ea7155a1433c7e74fb99813f28ec6b51a769a2851e25cb13bfa7041e807a508668683ff1ec910c3672c189e08ab52472c6d946da08e4038a82c1d90088c6cb1fde55c723b826b4aee191a3672084e9c9fd6a912cdbf05ead243a943321f954ec27a7b57b2da2b322bef5c119073d6be75d3a431ddc31a36edad90c0d7bdf876e7ced1eda527f8704d7661df4392baea6f470c6cb9cf3df06904080e0649a6c7790edc0c7e54924c011b3f8bb9aec39857b75c6307f1aa53c5b1b1dbb569af2371e4d54b940edf29e45005641b4e054b16d55e58601f5a636d079cfe359ba95c940634fe2ea6802c6a0e1f88ce47722b3d546fc01cd1e7621c13838a92c94382c7f3a9024b489bcdf6ad341b3b5668597ed7184e149e4569b86c6318fc6a80c489d52505466b5a20ac8af91c0e6b22da3900c6cc01daae2ee54c0c81e952365d5bd057608f807079ab315caa46488f9edcd64c00ac9cfe3564b30c003f2a046adbdc6f936bc6aa0f706ac259c127cca9df9aceb07c91918c56b41215231d0f5a00649681622221f8567ea366f0dacb30fe142c7f2ada32163ed59be2594c5a05f480ed2207c1ff809a996c54773e57f1fc8d35f39ebbb18e71ffebae6f4cb7914e171bc9ec3815bbe32dd26f38e9d38a83c3716eb7129392064e6b825b9dd0d8905ab2c0c3f8b19624d5616e1932c4f393feefbd69dc876c14752a491807a5511b8c9c1c632bd39fa7e9599a23366b5678da2da5e476de589e3eb525ac2d184742c0c4a0803b1e78abc9344a65240750a372a1f9b1c71cd56591a49843163904648ea091cff009f5a432796558558eff978727dc8c5470aabfef5c45e597c2b938dc98c038f7e48f5c5375341716922602b30da0fe7fa53ad51de0891c842577ab96ec38a002660f1456d6b2381f7412a3a0fa7e74b04138bc937b33c6a817200041fef7a0e9f953e28a42b2924b053f2329e31d07eb9a9e09632e2dd86760d8486c8c9c0fc79a406b68eb949636560aa411939c9ad568fcc80a312e8c3bd6469ee2299d17f76a8a51c9c1279adb819162da37671c64d342673417c9bd5f29c021b0727debdb7c0cd2dc690914619994e3af15e2ba8c406b85547ca0f427d6bdcbe1000f6524791b99011ef8ae9a1b9cf5b63a286dfc95c4bf78d1385da339abda95b37945c30040e95939b924028587a62bb8e32cdbdd63e4191e99a9d7006ea8628c36c72a571d01ab5e5f1c00334c0ad70b1f9658b723b563dec01fe707f0ad9bab563cae3df3555ada4030003480c068caf0c6ac581c385c1c1ab1776aca3cc2307bd67c970f1306c63e9480dd8154b0391bb1918ab67950dd306b9eb5be05b2b9cf4cd69c770ac832dc7a50000a8fba467eb48aaf2741dea1f24673c919eb5a56c815307e514015d6d262c08c73e95620b52d2152dc8eb56a15dc321b208ed535ba2ac9db27d680238edfca6c60d5a4e1f1d07bd5b8590ae188e3be2a85fddef7021e003d71401703051f37159be216171a15fc48992f6f2000ffba7157a06f3a35ddf78d57d653c8d26f277da7cb858904e06306a25b151dcf94fc43f3a4848e7350f86485b29a205410eb5a3afdbedb891146508c83595a28d8f749c80ca0e7e86b825b9df1d8b5713aa3fcb941bf0081daa19a28963259c36490303fcfb5375195d03089485c8dd9e7fc8aa125d46980d289158f441d0d41687aa8deb98f7310769cf20fa7f9f4a8e750a15d14a484ed2339fafe1505dce5846d0348a141dc59bf8bb1fcb8a89ae64cb798a8ac4f7e4608c6695865fb9b86556fddc45240010cbce7af6edd6a2803a20da985ddbd149240271daabc2e40456725481963cf7fe751cf7aa278e2591a424fcdec39e0fbd160b97156479fcc558d423fde238193c1ad682071249326d40adf290368183c62b3ed6125646072a467f01576ce59668e3bada790576f500f14016d6e251392c7e690e7000fd2b6ac274972a30a10018ce48ff0026b1ed4195b7792e8cbd0fbd6de96a9347e5103ed00f240c6ff7a04ccab9889d765380071826bd73e185f0b196dda46511c9f21cf606bcb66466d5ca6dfe3c60d76da7482da084060bcfe95ac25666535747bc34304c32555bd0e6aadc5ac48381c8e954bc31a82dee9314dbf7151b1fea2b5656565c67b77af462ee8e16accc8922ce493c52632700f4ab375b57835502ee60dd3d2a840558b6efcc5325c05e6acf1d05472c6aeb9c914019773b1c107a7bd62dfc09ca8207a574524118c8e4d665e5b649c73ed8a96073c36c64827a7a9a7437fe54801f9a9d7f6d9ed839eb59af0befcad0076d1c3e57c85f3e99a9c2ee8f6b1fa9aa1f6bded8ee3a5588652c87d7b521d89599c491ed6da13b0e2a49262cead9350a13bb27d29ee176eeeff5a2e162dadd48d0ec27b6334e882b6322b3d7767d2ac5b4b86c669858dab74000c1c01deb1bc7f7d1c3e0fd4c2f5680ae7ea40ad012b6cdaa4e315cdfc46473e11be600e005ce3d370cd673d8a8ee787ea51a4f6913a92dd573f8d645bdb2c12cce706320023df35a5137fa234673f2c8719ec0d457b2a4760cb86dcce093dba57033be3b1cf5cb932322ae5c9c201eb54a780bab7eef6c8188e7f33562f1e5691e350393b9581e9e955e0b9b8cf96f12c9cf61ce2a4a295c16824cac893c71306e46031ee3d7da992cd6f2cab2244a8ab1b230424e49191d6b5edf4499a78d844a526cba8704e063bfe63eb4a9a53daa48a50869221918ef9ce3dbf0a60623c81d5628a4907cea7e6e3271d7f3aa0e9751a3c8c9e5aee68c61863af39fc6ba6ff847a6bc96416f092aabbf25801e81727de9abe1c689da09ad995c2f3bb82a7a9a4328e9d7f1ab5b472cbf7ffd6b0192a3bf1d0f1daba06be541e440136272a71827dcfe155edfc359281a268df18e07a548de1f782153136e5453f2e3be781fd7e95371d8da89a08ac2daf226593cf250331e87bfe3d3f3ad2d1e5f943ca0dc1700920e30477e3f2ae5bca7b445792366666dabc71d39ad6d0a7862984314e5a5704b1e807d7fa50266efd9b7ea8d2f45c8239f6ad59a7532a8c8db19c0aa16f708d6fe6281bd7a85aa735c9f33616f989f980ad1107b47c2cbbfb45a5dc25b215d5d467d460d769c76ed5e69f07a6613ce831830f27e86bd1c38ce735df45fba70d556915ee1599b91dea2230318ab7210ebfd2abb7cb9cf3e95b19b207628475a0b909c2e6a5c824640e6a531003005024630694ca43e4034924391deb527b64ea739c55708704118f4140cc2bbd34c84919f71591736e6dd887e47d2bae994a83b8802b2eee249d597bf634ac067aa95391daac45248176926a25751fc3412cc7e53f854145eb7723219aa4761eb9aab12b9209cf35651474fe74c04df9eff004a5f3d633d0eea945bef194383dc5472d9483d4d1602c417adc641f6c54f7212fec26b3b88c34732146e3b1aaf6d038e49fc2b46da165fbd9e7b526ae816e7cf7e22d16e745d6a6b1991be53f29ecea7a11ea0d60eaa15ddd1581c2f41cd7a8fed29e2dd0bc27e1bb737ba71bcd527252c544bb361eaccc47f08e38c739e31d6be2ef1078f35abbd4649e1bb7b50c7fd5c4e481f9d73ba1767446ad91eb9a85c59dbcc527ba8fc92c3e6df8c7b8a865f17f863428983ca97d77b30043c81cfad786c5ac5ec92992599a4739c93cf5ef56b45b7fed6d5a38669e382324b3bc87000009fcf8e9ef47b02d554cfa4bc0fad2f89e359ac6c6eade38d8867908c018f515dce9da4696b3c705f4be64a54aa1ce01cff00faabc3fc3be3cd27c2fa447a769714935e370cbfc00ff5aedfc1b2ea5a9dd43acead318d54968a2dd800572cd72b358bb9d5ebb65686f64916c362ee20807ef71f7bd8e78c5505f219a332af5e99c8c1c639f735b2f776724b992e570992093dcd0f79a39610493c47775526b36cd1196f30dea426d08793e9c62ac98e3695a2d99565e6ac38d2827968f1329232a1bafa55c4d16352278a6650fc9079038a4c661dd69ab35a481d636eed9eaa3b60f6ac08a1b8d06e9a483cab98674c34457248c763dbeb5d90b578d248a3712ab019cf07d4d2c5a55a5f21738790a08f629e4734d099cfe8b7a64f9672886439dc3a01d318a85d192f589ee720fa8ad2d4747934e936416a5a3fe0c9c802993c925bc6b25c8779223b5b72f20678e2b4466cf4af8425237badfc485171cf4073fe15dfbb64100753cd78cfc3ad40c9ae22c6d869dd50e4f706bd8a40cae71f9035dd45fba72565a96220786029eea18f34c818043938e6a40c8cc06efceb73023f2c2b67ad5841f2e4f148c3033814d724c7b48ebde98859573f95539701f1c7d6a6677076e4902a092325b39eb40115c2a34782d82dd38accb88fcae8b9cd69c919240e702a65b459d01e011d450339548e2d99279fad4d146a4f41500420702a58e4c1c639acca2ec69c0e2a6580376155e02c491935603b838c73df14d01612220614f352aa6efbc0fd6a28998f4a9c4c036c02980f458a25dcd803b93515eea290005186dc7354f579b74451413eb8ae77579ae5adca46b9caf7a91a3e49fdae3c45a9ea5f142e60bb9c982d208d6ce353858e36193c7f78b724fa01e95e12ce77ee3c9af59fda704bff0009f2cf223c665b44c074c746619f71ef5e511a12e0950c3d0d52193586f9a4f2c0f949c640ad3ba91a1c58d9a33dcb1c129ce3db8ef5550f930ac3160dccc404ff006057ac7c32f0ac3636eb79e589ee9c64cadfc3cf6ff1a89cb951708dccbf03f8563b258afb572249080cb6e4e76fa67d3e95ddbf892e52416f1c654200491ce07d3bd45ae4091ef32398e53f7401924fafd2b91d6a08a18d6e14235c22e1994b727d41ae5e5e666ea563b983c4da473bee599c1386724039e9fe7d6b36ea7b7bdbf13dbea3b3e5fe139cd7945e6a70fef84b9824da4fcc0925bd8d675c5f5cd8cc5adee49518c61b23a53f6283da33da3c35e20b6b5f15436f25c6f1d816c8dc7a57a9def89e4b383cc8bf7911c9619e95f22e81793c9a9a5dc8e49439249f4af5dd27c63135b4704d893e5f9ab39d2b6c5c6a1ed9677916a76c8d6d71b46ddcc28bfd562f0f69971709879235e4e3d6bcdec75b865b56b8b31e46ce593d3de9fa96ae753d0eee088bc92344401d4f4ac94197cc8f4ad27574d5b4b13487cd2e99e4f02bcfbc5be2c874abd9a0bcde2198796f2e77b0f703dabccbc1ff00116e346b9934fba7fddeec004e0a9aa9e3cf12daeadfbd42c5b3827766b68526cce5348f7af87fab2bc96978b22bc680326d20670738faf5afa0d3518de14955c61c6e1835f0a7c1bf1388afdb4bb8cb2b7cd09cfdd6f4f7e2bea1f09eae66b448a776668f0a33dc1e95d104e2ec6151a68f514ba5788fcc07bd4b6b32373bbe95ca4774fe58d9c0f4cd5ad3ef1fccc1181eb9ad91834754d38dbc9a8a6bb50319e2a92c81a2e0f359d772b6fc67f0aa449b3f695e003934e594ab7cdd2b1ada52a0120e3d6acfdb133b4b7e745c2c6a33291c551796482632ab9183c0a8c5da06c2b75f7e9514d20903004138ec6860540809ce688edd776f19ce73cd3a2607a0a903ae3a815050f8b0b8e79353ae09ce07bd53772c7e5a9048cb8a6058694afcaa69aac412ccd5049280a77703d6ab0b856c8078cf14302ebb1957f9556789243b5d73ef4e89fe5c31aafabdcfd934bb89f761913823f2a99685247c83fb5f209bc4f617aaa76b09a2dc071f2b0c0cfe75e1f105505d87cabc919afa6be36686de20f075c18d3371624dcc648ec3ef0fc466be68b946052de35c93c9fa5284ee8b71b1d07c38d106b1aeacf70a5d55b2a3d4d7beb88b4fb248a2da5f1c01d16b84f85d05ae93a34724981713e769240c2d751aaf89b47b1b7653e4cd718e03b71f9573cef291b46c919f7af636d99f51ba8e4998f463923db8ace8b54d2272eb1c6aea79c673ff00eaae275bf1859cb3dcf956c77c80ecdaa080de9f4a4d3a592e34e371246639d3a103a8ad141a27991d3ea7e1bd23538f78565c8e77000e71d4571bae7832fad5668ec4ac88c06377391d783d8d3dbc51790bec5cbed3d73d2b7748f14452b0f39954be00dddbeb9a7aa11c6e9da16b96f1b27d8ce4f3c1e6b5ac349d6e07def68ea319eb5de47acda473b2492db8f28827e71d3b559bcd674d2a8e248f2402cc4e307d3de937728c8d3e596344760ca71f3a91c11dfeb46957b25a6ab2db4b2308989008f435a2d2437d645ad8a498e70a064fe34697629a8d998c45b6f2dcfe2c2a067997c58d0ce9baaa6a36e4b5bdd7208fe161584b297b14b8db907e4700f46f5ff3eb5eb9e30d31751f0fc9a7c8bb71f3237f75bd7e95e3b60b25bdd5c69b3fcb9c820f6615d34a57d0c2a5d32ee937ef637d0dddbc85648d830afabfe0a789acfc512218c04b88d00922dc7e53dcfb8f4af8f959e290e0e194f5f7aebfe1a78d351f08f88e0d5ec6422443f3a31f9255eeadec7f4ad1c6e67cc7dfc2cbf895b19e82a58a2f28fcf86158be04f16e99e32f0e5beafa5960ae30d191cc6e3aafbff856cb4b264ab0e6a2c06c40d16df94e69f25ba38cedfa9ac4b26717030f81dc56dc6e5976d3132adc88a15c82178ae7752be0b210a46e07a66b5b5c59403b50e31d6b9592179242421e4f22810e7d56546c67073c8cd5bd375572db99b9cf7aa7269b001be490ab1f5aaaa369da00383c106819d8ee3938a6ef727afe942c833b7bd481091c63d6a464d0ba81800e6973bdb18efd6a148e566c01f5e6acc51ec23ebde801be4338c1c63b52ad8ae739c5592428cb7e54c926f978ef41488c848db18e6b97f88578b0686630ccbe6b638f415d034a4b3123935c47c4162d2411827038c76acaa3b22e0b5381f114922786b539a32bb96d252aecd819da719cd780e83e139d3c3e751b985bed176ca111872910e71ec4f5fcabe92d56da3fec99a37895924186565cab0f71deb84d65443a3bcb2001c96c0c76e95cb19b474f2a6788ea9adde5b5c5cc30078551446a7bafb0f4ae627d42f84efe738dea76b6f6e735d4f8a22686e53e51f7f7863dfd2b89bb6df7b348721998b60fbd77d349ab9cd51bbd89d2750e6e18e193185233b8ff004aece0d5aca5d0e2b88e54591c946846772e00e4fb735c4f944c40056dc7a814e5b5b888012068830071d335ab4999a64d2df39ba90705734b6b3a4b236e6c63d6a12b0a9c6e19a4f2236e6327a7ad4b8a1f31a5a7c4d7d71e5c0fb554e0b83d2ba1bb369a5592bce92487a63a93f9d729a0deff0067cae921da739c9a4d6f5992f1d910fc99e09eb59fb3bb2f9cf45f07cb6f73b6f34cba08f9c3c6dc67d8fa576f670bdbdfadca8920987df43d181f7ef5f3f681a9dd58dc2886e248e32e1d954f048e9fcebe80f04788acb5fd252da4915ae625f973f78565520e26909731a5ac5a433a6f5214b2e48cd785fc43b06b2d7bed28b8391902bdcb55e2d10f99b761e87d2bcf7c41a3b6b9aa242807bb1a54a566138dd1e5d74d990bfaf34c49083e95a9e2ad2a7d1759b8d36e07cd09c03fde07907f2ac7da4b62bbd34d1c8f467b3fecdbf10efbc2de2db5b337127f66deca90dcc21772b12701f1d88cf51db8afb72da45b8986f8d463ad7c75fb27fc37b9d7fc510f892fa065d2b4e93cc0cc389651d147d3a9fc3d6bebfb8dc929299c7a56721dcbf71648ae1e3c01ed45b1dafcb5361b876871229c7515424bac4e541ef52237a7b549e3da4e091c5531a42890600619eb8a7c3761c824f2a3156ede7dc546ee49ee3a50062eada109be68ce1bb9c561ae9724329598065fef01d2bbe781a60423ed20f38acdbab3955f2e0b2679e293039b8e425f24e2b4e139419ae7a1bc82423638dddf15b104ff0020526914682f0323ad0ccc4f4e950c332eccb1ef4e9651b090707d28631d23963d6a17981390791d8d22ce8cb91d7d2abcae19b70fc4521a25627ae6b93f15856bf88bed384ef5bb35cec38c9e3d2b90d7ae1aeb53c64ed40074ac2abd0da9ee65eb0e6685e3523853ce2bcc3c7973baf6dec46318f982d7a26a123665c11b4f18f5af23f89ecf6b7569a8216f31642a707822b963ab37388f1dd9bc9332aab6020208efe82b85b6b59a69774a76a027e623ad7a6cd7761add94935f5dff0065a5ba67cc2bbccdec17ebdfb7a579fdcc915f4b02cec2d231f2bb839e3b13fcbdebd2a5a2392a6e43737f6b6a8238220587524d66cf77717b30cb31206d049ce00ad9f10c1e1f586d57479669e5db89ddd48048c73cff00faab21a250b94711be3afad6c8c867d8965883a392c5b1cfad4077dacb80e187b1e2ad4774634f250eec2b1cfab1aa2e8e10128c327a91d6860997678d6ea012447322f51eb546388b971d36824e69f67726de4271907ad5bbb8d5e3fb4c230181de07a7ad2199c0e3b9ae8bc2faadd689ab47745d94a60b60f55238ac18e3dd2019523eb5d069d64f785a33f3cb395e71f75474ff000a995ada9516ee7b0e81ad2eb7a53cf9c863d0f635a7a75a4512a385f9a671b8e33c5667877415d07c2b1b8469249641bfdbdeba2b10c65b3440761393fceb865a1d2b530fe397831b52d1adf5ed3edd9af2dd424e88325e3ec71ea3f91f6af37f85de00d63c69e2ab5d22cad9c0771e74a50ed8933cb1fa7a57d4da68124811b27a6715e8bf0e3ecf692cf1470448ce410523009ad68d57b195587536bc21e11d2bc29e1cb5d17494f2edadd00f773dd8fa9279ad19208c73d6b401c9c91c5412bc458a1c5746e7399d2239c85ace96d250fbc9adf0b1ab7cb8fc6a2ba689885cad0065dbee3c03d3d6ac8b9f2c92c7a5420a2b90a47e14f68b7f27f2a00d7d22f0bb1673c638ab42e3cc770d80074ac7823645e0e29f13488c49c9a00f3cb5b709f36f0707f84d5e4ba914e41c81eb58962cc41018951c64d5b8e42bc10481d38a9651b11dfb6d19c2e0d2b6a4c72a79f7f5ac59599ff2e3d6a36768d086248fad219b82f89e17938e71514d74396dcdd3a563c570c1b72b741d0d2cb745ce0faf352ca45c9ef4f96580cfa8ae664b9dc669cf5c90077ad1bfba3f67750a14282735ce404bc4e49efdfbd735566d4c8afa2b89446f1aa9072002e073ef5c578c34c5d52d3636080d9c871853fde27a6075adcd5a64595d9b8545c019a925d7348834b8a3b0b5433c8819e6619c107b67a1cff2aca1b9a33e73f10a1496e23572c219f60008da063a7ae7af35ca5d5d4ac4a70aa3b0af50bdf0bc7763c4db9251736eeb2dbb1940f30316f9403ffebed5e492ab0919482307915e9d3b58e495c9e13bb19fd6a478837fcb4c71d2a1837b0ca231f7ab1e45c38e236ce2b4332b18cb6e318e41f5a8d9ddc61c9241e84f4a74de644d860ca7dc54058b3649a2e33a9f879e145f146a724125d0b78620bbc819724e7181dfa7d71d01a8fc59a23785fc477ba049769791c44279f102012403d0fd6b6fe13eb9a0d85e9d3f54fb5c71dec913492a4a23dac8491f30e40e7279f6e6b7be2af86b4ebff1135c685aac124d3c905bc16ecea0bee538604741d060f3dfa5219e61a65a79973b095ce7806bd2bc35a04b6d2c570cbb8390071589acf837c43e1ad36d759d52c9e3cb149130494c7738e31ef5dd78475db5bcb2b753247b55ba7706b1a8f434a677d3471be9b1da49f7768c815069f086bc409238c1e84e718a4d46f23544d831238007b0ab7e1cb67f355f9c6735c527a9d08eb7476712fcd83815dbf822efcbd7915f76d60571ef5c56999049ef9eb8adef0f5cc89ab230fbca72a314e1f1132d51eca550a02b8e9eb59d770317e58023b8acc4bf9c95058b63a815662ba2f1966049aed4ce47b91dc79913125bf5acb9ef836e5dfc8f4a678a7506b7891e3c92d9ca815c2beaf22c8ccdb9727a5303b382ef32e377e26b6ac665940c9dd8af328f5925d588214f7ae974ad5949055b6fd68433bd455200152c31023711c74ac5d3b558e5c296f9856bc77033b87dda649c669ba646a649193907b0a8ef74f2c5a48f86ec0d6f24f13703a77cd559995e6f94f07b52651cfc76ad2732651f1d31515de9f97018ed38e09ef5d3b6c64f947cdeb8acc9ade6624cad903a629580c3091421c9427df151ab272761fa62b4a6b776655443b734f8a07c9c460afa1a9b149987a9a66c2761161761e4d7296b2016d31039ce00cd7a4f886c245f0edd3950b88b38af2ab6958492c67bf7cd72d6dcda9983af31dae08ce3b67ad73d7ccc9347121c051c01db15d06bd932727bfe95817fb7cd76ec062b04cd8c4f1769373a95a47abd8da799776a369651c9183c7d45795ea734723aa3daaa48846e0e98fcebe80f09dd4eaf736f0c70b248bb99a5cfcb8e074f5ae4fe287831af23fb759c71add21dce8bfc5ec2bb68cf439ea4753c78baabfc80607602ac1b84c80a38c73ed4cbcd3aeece668e789a371d41150b2ba7041fcaba549195896e244910a6370f4359534655b207156a4600e3bf7a40f956c103d29dd058ab1b6d60db54e0f423835a771a95c6a3accb7d2858de67de563c855e3031cf159f1a48d26d085893fddcd747a4f8475dbe0156d960562002fd4d4b920b334350f1deb5a969a347964f311d3ca9a51cb5c80415dd9f423b63deb7fc156820b98e72366c5e401c13ef567c37e0bb7d1d645d462925be76fdd38c144f7fe62ba3b2d1cda485a5501b38dbeb58549a358235ec964b8769a65f989c8cf6aeb74aca5be531c572f14cb13aa138623e406b774dbc404301f2b0dbf8d73335b9d469372b26e404671eb5b1e1bccbacc51a9eaf8c0ae4b4b6d8eef81b01e6baff0000933f886160460671da9c7713d8f5482c8c44ee6465ec3152fd9c153d323d2ab979828db9c0f4ab76b2ef8f07ef77aed5b1c8f739ad49ddaf9a378c90bd091dab9dd5f4cb495bcc451bd4f201addf1b5f3d84cac90b392a480a3a8ae21ae6e275c43248cec320275cfa550172d2c3ed08c82cc808d8cd2c96c6cdc1e403d8d5bb09afe08b6981be5c072c3a9a75cb7da1bf7d1488c7b638a919634c95fe59030ce7a66babd3e69258465bf0ae7349b2510eddc33e95d1d9c6628c2e703b91da9a1332a02c7ef360f6a9b6739c927e94db764112e30481538752323a0a18c450e3a2f156123de172bf9d422455382473ef5621b98d81008e3de900efb1211bb6e07a0a23b24490be33ef522dc063e8298f7599397000f4a180cd6ad84fa55cc207de89b23d78af9dae656b7bf6473debe8c92eb1c70c08f4af9ffe2369eda7ebf380b8476de983d01ed5cd591b527a9435745961561cf1e95cb6a1190c7bf3deba0b7ba0d1889b927be6b3f528fe6f945731bdcc949ae6d51bca94a6fc670067ff00ad55e692e248e5896e5f2e305c9c91576581df0beb50f91b5febfca9a6d03d4e6c88a09a383548bed0dd37b8ca93ea296f344d22fa27962b38db0320270735d05cd94375198a65dc87b1f5f5fad73175a6eafa45e86b12d3dbc876e49fb99e99ff001ade333171b33125f06432ddac705c1457ea581c2d685afc3eb189c19af2494f5ca6307fad549bc4f2c37452eadde3643f3e0f39157eefc7162605085ba80703db9ad136c9d11d1699e1ed074edaf1daa990720b9cf35d169d259adb4d29651143862179c127838fad7971f154529de18e3b126a8cbe2865674573b5b20853d6ad424c9738a3d3af75ad39b5090c6fc07c862319a6b6b564d226e91402e00e7bff009fe55e3b3dcdedefca85d493c126af69165772dc2a07926998f032719ada1846f5918cb1518ec7a25e5e5d6a1aac535b9d96d06555979f309eff004aebf4d91dd36e40381cf7ac2f0bd94b0d8c305c63728f9b8aeb2dadd23f9c2015cb59ae6b23a6927cb77d4d38d84569cf563935dd7c39b564592f3772000bf8d799c626b8bd50a485dc38afa07c1da543a6e896f6f226e95807727d4f6a8a6b51cde86b69723cd1ed2bc8ed5a76f6b82180ebd45470c70afdd014e39abb1100ae0f15d68e7662f8bf4e79b4d630c0ae463393d07424579f5cdadde91727ecf66939ec4f19af5abbbe8205193bb3c60566ced049fbc68d70391914c463e856d71796bbef225527b039ab6fa5daf9d86c31519e40a7b5f287215b6f3d2a8dd5e6c423383498d0a6d6de290c8833c75aacf74c67e58851511bef323d808e073cf355c85955b69e7af3486cad692b44332363daadcb74bb4aaf19e845635c4ff2f0bc8ef9ace96ea5c97de463a0cd303a16b860324d2433ec6dc1bafad73a977237cb926ac5bb4b23f2081f5a433a68ae895e49a865b86dd9c1fceb3e36753d4e7d2ae20c904fe39a01934571230c7f5ae7fc7de1f3ac696d2c299b9841618ee3b8ae81700f0a2ad478db83ce2a24ae34eccf9be485e27c104329e41a7b624500f1f5adcf185ac6be21bf882ed6599880be99ac10154f0dc67bd71491d317a0c16e79cd46f0afcd81cd5cdf91d7b544e40e73523b99ef1e1d4138a7b2065c607b114dbadc4eefcaaa79ac8dc13c1a685b9937da4c6356937c292dbce377cc33838f7ac3d63c156374fe75862d660738ea871db1dabb96759539fc4556c00e715a466e2c974d4958f35bff0008ea890b14804b91fc073835159786ef1d78b1915fb8906315e87733f96bb57ae7f2aaf6eee5f71e79aeb8e36496c733c1a7d4c1d37c252965334cabcf21066bb0d134882c195123001fe2c726a7b5c141818e79e6b5e1452aa7deb3a98aa95346cd29e1a9c3644d6d6be44d8cee46e99ed5a8f811855e07b76aad1362350e7357b4db537332bcbfeaf3c0f5ac0dcec7e1a7869afef06a52c4a6da0e84ff00137502bd1fed13a5c9da79ec0f4ab3e128ed23f0ce9eb0a2a0f28671ebeb535cdaaa9320239aea846c8e793d4b16b3196252e406c73524d3154c2b1aca9ee3ca55e178a88ea2141c8241ad119b1b7324d35c17049e6aec4c5edb69241f5acf8a7134b8c6df7ad042a89c1e94c4674b049bce0e40a49edee2488e4647a9ad48de365c6060d5986dd5be761c11d33401c84f65227dce58f606952190365c15603915d5dd416917ced1ae738069d14764b1ee976364e06ee735251c0491ab7cbb873d6b3ef6d006f9483ed44b26c27f798345b396937127ea68b8d0db4b47de0b2fe15b1676e00e47e749681580259481ed5743c3d4bf4ec280645e5b2f2578f6a91474233d7b8a98cf0ed00b8c7ad34cb136486e6810e4ce40cd4bbd8719fd2abbc9b7a01cf7154e5be21c2ae723ad0c679a7c51864b7f111b903e59c6723b91c1ae4e675d995e49ed5eabe34d3d757d3bcb0a3ce53943e86bc92647b7b878e55dacac4107b571d48d99bc5e854f3e4591b19c03cd4eb70ec391fa5598923738201cf5ae83c3fa6584d7189d7747b49c56655ce600128c62abdcdb9ea075f4aa7f12f561a2f8a2cf4dd37e769dc298c0cb2ee380715ebda2f85f4d7d3a179d4cae577371d7e954a0c9e73c88a32753cd3002c3009f6af41d7bc1726d967b189b620caeeea6b91d1343d5efb579acded3ca58d8265f8049e7f2c734f91873984d6accf927bf7ab11470c6393cd7ad5a7c3dd2cd9a09e7926b8c1ddb0e00fa5564f879a58b8f2e4f332c7712cc781e829f20739e6eb3c6a988c66ae58dc3cefe505c7bd75be2af06d968da4b5ddab6e60f8604f4cd7171c9b643b24d8c071814ac5277376d11964fdef51ea6b56d6f449751c517620715c8c9772b13b9ff002aea3c01a6cfa9ea90c19210b659bfd91d69adc19ee9e1e99a0d16ce33c1118cfb679ad53781fe51ce3a8359d1ec4895540daaa140a1932db83e323b576456872c9ea45acc45e32f1bb2b63a01906b9eb59ae6399da46fdde7e5001ce31df3ef9ae82e1cc3197906e03afbd52b8305cdbb18808d8fb5508645724481965e3b66af47a832fcacc18773580b1b228573f393d8d3a231e1be72307b1fd295c763a2b6bf85a5183806b45f52558c00dffeaae119e685f73498e7b1abb6d78648f073953d4d203a17bef30e4b6ee73489780bab1040078aa107ef61cecdb8c6054f0c40fde6c1ed401c7fd9c365cb96c77a75b5bcdbc10cbb49e41ab51f94c9c9e31d6a3b8b98add70ac4927a0a4343e6945ba72e1463205655d6aa621b9dfdf8ac7d7efe6790fccc3d05259dbc973658c966236f3fce819a50eb4262155f1c7357edafe42e06ef941eb5cdc1a2de89067e5c0e4d6f5b5832463cc9003ed4ee2b1b30ea4850866fcea28aea19a46c0c11c73597246635fbdbb9a58a526411a86c9f5a4336cafca4e33e8719af27f8876a22d7ee5d46d638638e8723ad7ab5acac13e66e83bd790fc45d4c4fe23b87460557e4f620715cf5cd69982b70ca78eb9ae8b4bbd68a36270ac884e08ed8cd71f25c26ecab11ed5ade1ebc41720b80ca3ae46777b1f515cc9ea68d6879368b76de20f8a50bdeb5c5e34d73b6378ce18e3383ec3a7d3d6beccf0d5b8fecd440a576a80a739e07ad78a7c3bf85b6563e2a9fc410df49342f237d9e289368891bef2b1eff00dd18edd6bddad6dcdb00901623aed22bb56c72b1f3db064f2c4cd1e4f240ed59b7da45b34459db73a9dd95386fa71526b3712c516ec15607aafa565d96b251364f0347b8e32ce371cf7c53044fa7ab4b2bc91b15118c8c7ad5978a699432ba311d3269a258caf076ab1c654d35ee2d937c904be63270c076a4332bc696d31f0e5f07756509bbf2af150db67673db8af66f17eab13f87ae91012ce9b0fb66bc4ae641e6b8195e7ad633dcde9ec5cb72af2051c9af61f82b64af35ddc3a64246101faf5fe55e2fa44c5a500edce78e6be86f85cb15af87e2ecd2bb331f5a74b59054d8e9b50c409bd0720d678d50afcadf856dba4328f9806e2b36eedd0ae6240ac3af15d88e52a35f79d2ec957e461d0f7aaf33a4326c8580e380d59ba9ea16b69a846934891ee6e32ddfff00af4fbdbfb3bb006f50ea31b89e9de80197dba29bcd2c1838eabdaa91be4b72e5a3666ce7afad3ad1575285becf36edac549079c8383566e34a691572651b46dcaf7f7a4c663deddb4d931370a3270dd3f0ab7a1dd48e5d59f182376692d3479039742e1ce410c339a4b4b578cccaeacbf3e30473f5a4074115e91fbb8d87cb8c0cd5b8eed4a6e270dee78ae4d6f046586d62c47155e3d5dbe658e5566c7dcef8a00b1a7b4a898965007719ab17284c6c612a1f0705aa8dcee57da140f53eb44574519a2eb20f7a4054b7d1afeea5cdc80233d08f5adad334d7b0973f2f9206482739aa53dddf79785570477149a6c97733ed99a6c75cb0e281a37249fcf8ca5b90ac47031d6a81d36f95fccdc739e73e953c16987044a770ad08e4947cae77628030ee84c300231f722a7b749366f906cf726b565640bf30073ea2b9df14ea915ad9bc8570a8a59b1dc54b65221f136bd169fa7bac522991c61307a7bd789eaf7c65ba762d9e4f53d6b4f51d60ea566da84f30c48495507841d857251c336a16f2de5a3ef8d5ca649ea476ae59fbcce9846c8b4b36e279fc2b5f41656b9542e00cfad71acf771b15788fd6b6346ba31c4eee9b9b1b767a9f4a9511cb63de3e1d59be9ba44503ea86f243f349295c6f63df1dabd02d24dc8bf306f538af24f0d48e9650089f6fca3233c83e95da69b77703602df5ae989c8d6a749a941e646cea1490bc83deb89f1058c8b2c0e191001f4fd6badfb406424ff3accbfb78ef18c6f9d832460e39aa158c4b51756d230f3449196fbcc381f4f4a976a7da9a6924db237de503834db88ae601b76798b82304e47e754d7ca930d1fee248c65c6324fe2693195f5f168348bc3b48fdd920e7bd78e5fca3cc6c1ea72315e87f11752f274c5b65b8690c8e58e48c803b1c57964f2efc9ef9ac27b9d34f6377c3722a5cee2b9e08fa66bdbbc237a63d2add11b9eb8cd783786dc99803eb5ebde119de5885ac7b4900107d28a72b482a2f74f4cb1be653994e430fcaa4bbb92497429b73d33cd73b37da522c48762a8ce7354cdfccabe6c32a3ae78c5769c860f8df57b2bf9a7b2103caf19c1c02007073d7bf183c57866a7f156f34ff0010cda68b437091cc210eaf83b7b8da78273df22bd6bc5f792d80b88c3ae25479da5584610642e0e7a9c93d3b035f2f6a7126afe3475d32290c77174aaa324f3900f3e99fd2981f5d78335e42ec2131b619413ea48f6fc8d76d15d4b2a6f923f270700eeea2b91f0c786f4c82c2d92688f9c9182de5b630d8e49f53ef5d54771636f008258cac79c024e69302da5dba7c8f1b15ed8359daa18e7749b6367ebd7eb48f710f987ca772807cb86e95369b25a5c12262dbba1c8c52039ed7ad44f0a17be5b542d9e0f2c476fa566269d3d9badcc3b66ce4139af4a7d22ceea10094954038dcb9c551fece82ddda24877719009e94ec07ffd9");
        $this->assertTrue($thread->setThumbnail($pugImage));
    }


    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testFavoriteMessageThread(MessageThread $thread)
    {
        $this->assertTrue($thread->favorite());
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testUnFavoriteMessageThread(MessageThread $thread)
    {
        $this->assertTrue($thread->unfavorite());
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testRemoveMessageThreadThumbnailImage(MessageThread $thread)
    {
        $this->assertTrue($thread->removeThumbnail());
    }

    /**
     * @depends testGetPrivateMessageThreadsWithTustin
     */
    public function testSendMessageToPrivateMessageThread(MessageThread $thread)
    {
        $message = $thread->sendMessage('Hello @ ' . time());

        $this->assertInstanceOf('\PlayStation\Api\Message', $message);

        return $message;
    }

    /**
     * @depends testSendMessageToPrivateMessageThread
     */
    public function testWasMessageSentByTheLoggedInUser(Message $message)
    {
        $sender = $message->sender();

        $this->assertInstanceOf('\PlayStation\Api\User', $sender);

        $this->assertEquals($sender->onlineId(), self::$loggedInUser->onlineId());
    }

    /**
     * @depends testSendMessageToPrivateMessageThread
     */
    public function testDoesMessageContainTheActualContents(Message $message)
    {
        $this->assertContains('Hello', $message->body());
    }
}